# Redis 야무지게 사용하기 [영상](https://www.youtube.com/watch?v=92NizoBL4uA&t=1375s) 정리

## Redis Cache
- 데이터의 원래 소스보다 더 빠르고 효율적으로 액세스 할 수 있는 임시 데이터 저장소(Temporary Location For Speed)
  - 대부분의 애플리케이션에서 속도 향상을 위해 사용
  - 동일한 데이터에 대해 반복적으로 액세스하는 상황이 많을 때 사용
  - 데이터 재사용 횟수가 1번 이상이어야 의미가 있음
  - 잘 변하지 않는 데이터일 수록 효율적
- 레디스는 **캐시**로 사용하기 딱 좋음
  - 사용이 간편 : 단순한 key-value 구조
  - 모든 데이터를  메모리에 올려두는 **In-memory 데이터 저장소**(RAM)
  - 빠른 성능
    - 평균 작업속도 < 1ms
    - 초당 수백만 건의 작업 가능
- 캐싱 전략
  - 읽기 전략(읽는 작업이 많을 때) : Look-Aside(Lazy Loadking)
    - 캐시먼저 확인(Hit), 없으면 DB확인(Miss)
    - 새로 서버를 올리는 경우라면? 갑자가 Miss가 많이 발생하여 서버에 과부하가 올수도 있으므로 DB에서 미리 cache로 값을 세팅 -> **Cache Warming**
      - 상품 오픈전에 미리 DB에서 cache로 올려주는 작업을 함
  - 쓰기 전략 
    - Write-Around : DB에만 저장
      - miss가 발생한 경우에만 캐시에 저장하기 때문에 데이터가 다를 수 있다는 단점  
    - Writh-Through : 레디스, DB 저장 두단계를 해야함
      - 동일한 정보 얻을 수 있음
      - 상대적으로 느리고 데이터를 안쓰는 경우 메모리 낭비
      - 데이터 저장시 얼마만큼의 기간만 사용하겠다고 하는 expire time 지정 하는 것이 좋음 -> expire time을 어떻게 지정하느냐가 장애 포인트가 될 수 있음
## Redis 데이터 타입
- 많은 자료 구조 제공
- String : 제일 기본적, set 커맨드
  - 단순 증감 연산
  - INCR / INCRBY / INCRBYFLOAT / HINCRBY / HINCRBYFLOAT / ZINCRBY 
  - `set score:a 10` // `INCR score:a` - 11  // `INCR score:a 4` - 15
- Bitmaps : String의 변형
  - 데이터 저장공간 절약
  - 정수로 된 데이터만 카운팅 가능
  - 서비스에 오늘 접속한 유저 수? 날짜 키 만들고 유저 ID에 해당하는 비트 1로 올리기
  - `setbit visitors:20220503 3 1` // `bitcount visitors:20220503` - 2
  - 정수로 표현할 수 있어야함
- Lists : 큐(**메시지**)로 사용하기 적절
  - Blocking 기능을 이용해 Event Queue로 사용
  - 키가 있을 때만 데이터 저장 가능 - LPUSHX / RPUSHX
    - 이미 캐싱되어 있는 피드에만 신규 트윗을 저장 -> 자주 사용하는 사용자에 한해서만 저장해두기
    - SNS에서는 사용자별로 타임라인이 존재 & 본인이 팔로우한 사람들의 데이터 존재 
- Hashes : 하나의 키안에 여러개의 key-value 쌍
- Sets : 중복되지 않은 문자열의 집합
- Sorted Sets : 중복지 않은 값 저장, 모든 값은 score 순으로 정렬
- HyperLogLogs : 굉장히 많은 데이터 다룰 때 사용, 중복되지 않은 값의 개수를 카운트시 사용
  - 대용량 데이터를 카운팅시 적절(오차 0.81%)
  - set과 비슷하지만 저장되는 용량은 매우 작음(모든 값이 12KB로 고정)
  - 저장된 데이터는 다시 확인할 수 없음 -> 경우에 따라 데이터 보호를 위해 사용 가능
  - 하루 종일 크롤링한 url 개수 몇개? 검색 엔진의 유니크한 단어 몇개? -> 갯수만을 알기 위함!! 
- Streams : log를 저장하기 가장 좋은 자료 구조
  - append-only
  - 중간에 데이터가 변경 X
  - 시간 범위로 검색 / 신규 추가 데이터 수신 / 소비자별 다른 데이터 수신(소비자 그룹)
    - id 지정 안하면 시간으로 id 지정 해줌 
    - 카프카 개념 많이 차용 (카프카도 찾아보자..)
    - Streams을 메세징 브로커가 필요할때 카프카를 대체하여 사용할 수 있다고 함
