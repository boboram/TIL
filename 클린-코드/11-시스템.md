# Ch.11. 시스템

> "복잡성은 죽음이다. 개발자에게서 생기를 앗아가며, 제품을 계획하고 제작하고 테스트하기 어렵게 만든다."  - 레이 오지 

# 시스템 제작과 시스템 사용을 분리하라
- 제작과 사용은 아주 다르다.
- 소프트웨어 시스템은 **준비과정과 런타임 로직을 분리**해야 한다.
- 시작 단계는 모든 애플리케이션이 풀어야 할 관심사이나 **대부분은 관심사를 분리하지 않는다**.
- **초기화 지연 장단점**
  - 장점 : 필요할 때까지 객체 생성 X -> 불필요한 부하 X, null 포인터 반환 X 
  - 단점 : null, not null 두가지를 테스트해야 한다. (SRP 원칙 위배), 한 두번 사용은 괜찮지만 애플리케이션 곳곳에 퍼져 있으면 모듈성이 저조하고 중복이 심해진다.
- 초기화 지연 외 방식을 고려해보자.
  - **Main 분리** : 생성은 main / 사용은 애플리케이션  ==> main이나 객체가 생성되는 과정을 애플리케이션은 모름 
  - **팩토리** : 객체가 생성되는 시점을 **애플리케이션이 결정** -> 인스턴스 생성 시점을 애플리케이션이 완벽하게 통제 가능 
  - **의존성 주입** : **사용과 제작을 분리**하는 강력한 매커니즘 , (DI, IOT 기법 사용, SRP 보장)

# 확장
- **처음부터 올바르게 시스템을 만들 수 있다는 믿음은 미신**
- 애자일 방식(점진적 반복), TDD, 리팩터링
- 깨끗한 코드는 코드 수준에서 시스템을 조정하고 확장하기 쉽게 만듦 
- 건축과 같은 물리적 시스템과 다르게 **관심사를 적절히 분리해 관리한다면 소프트웨어 아키텍처는 점진적 발전 가능**
- 원론적으로는 모듈화되고 캡슐화된 방식으로 영속성 방식을 구상할 수 있으나 현실적으로는 온갖 객체로 흩어지게 된다. 
- EJB 아키텍처가 영속성, 보안, 트랜잭션을 처리하는 방신은 `AOP` 를 예견했다고 보인다. 
  - `AOP` 관점은 **특정 관심사를 지원하려면 시스템에서 특정 지점들이 동작하는 방식을 일관성 있게 바꿔야 한다**. 
    - 자바에서 사용하는 관점 매커니즘엔 `자바 프록시`, `순수 자바 AOP 프레임워크`, `AspectJ관점` 세가지가 있다.

## 자바 프록시
- 단순한 상황에 적합. ex) 개별 객체나 클래스에서 메서드 호출을 감싸는 경우
- JDK에서 지원되는 동적 프록시는 인터페이스만 지원하고 클래스 프록시를 사용하려면 바이트 코드 처리 라이브러리가 필요하다.
- 프록시를 사용하면 깨끗한 코드 작성이 어렵고 프록시는 시스템 단위로 **실행 지점을 명시하는 매커니즘도 제공하지 않음**

## 순수 자바 AOP 프레임워크
- POJO 로 순수한 도메인에 초점 + 설정 파일로 기반 구조 구현
- POJO란 오래된 방식의 간단한 자바 객체 
- 설정파일(xml)에는 영속석, 트랜잭션, 보안, 캐시, 장애조치 등과 같은 횡단 관심사도 포함 
- XML의 장황하지만 프록시나 관점 논리보다는 단순하다는 이유로 EJB3 를 뜯어고치는 계기가 되었다.
  - EJB3 : **XML + 자바 5 애너테이션 기능** => 횡단 관심사 선언적으로 지원

## AspectJ 관점 
- 관심사를 관점으로 분리하는 가장 강력한 도구 
- 관점을 **모듈화 구성으로 지원**하는 자바 언어 확장
- 새 도구를 익혀야 한다는 단점 

## 테스트 주도 시스템 아키텍처 구축
- 코드 수준에서 아키텍처 관심사를 분리할 수 있다면, 진정한 **테스트 주도** 아키텍처 구축이 가능 
- BDUF를 추구할 필요가 없음 
  - BDUF : 초기에 모든 것을 완벽히 설계하는것
- 작게 잘 분리된 아키텍처로 빠르게 출시 후 조금씩 확장해 나가도 괜찮다.

## 요약 
> 최선의 시스템 구조는 각기 POJO (또는 다른) 겍체로 구현되는 모듈화된 관심사 영역(**도메인**)으로 구성된다. 이렇게 서로 다른 영역은 해당 영역 코드에 최소한의 영향을 미치는 **관점**이나 유사한 도구를 사용해 통합한다. 이런 구조 역시 코드와 마찬가지로 **테스트 주도 기법을 적용**할 수 있다.

## 의사 결정을 최적화하라  
- 때때로 가능한 마지막 순간까지 결정을 미루는 방법이 최선이라는 사실 
- 관심사를 모듈로 분리한 POJO 시스템은 기민함을 제공한다. 이런 **기민함 덕택에 최신 정보에 기반해 최선의 시점에 최적의 결정을 내리기 쉬워지며 결정의 복잡성도 줄어든다**. 

## 명백한 가치가 있을 때 표준을 현명하게 사용하라 
- 아주 과장되게 포장된 표준에 집착하는 바람에 고객 가치가 뒷전으로 밀려나가는 경우가 많음
- 표준을 쓰면 이점이 많지만 표준을 작업하는데 너무 오래 걸려 업계가 기다리지 못한다. 

## 시스템은 도메인 특화 언어가 필요하다
- DSL(Domain-Specific Language)
- DSL을 사용하면 고차원 정책에서 저차원 세부사항에 이르기까지 모든 추상화 수준과 모든 도메인을 POJO로 표현할 수 있다. 

> 시스템을 설계하든 개별 모듈을 설계하든, 실제로 **돌아가는 가장 단순한 수단**을 사용해야 한다는 사실을 명심하자. 
